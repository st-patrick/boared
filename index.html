<!DOCTYPE html>
<html>
<head>
    <title>Trello-style MVP</title>
    <style>
        .column {
            display: flex;
            width: 200px;
            padding: 10px;
            background-color: rgb(242, 242, 242);
            border-radius: 5px;

            flex-direction: column;
            justify-content: flex-start;
            flex-grow: 1;
        }
        
        .item {
            display: flex;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .placeholder {
            margin-bottom: 10px;
            padding: 10px;
            background-color: red;
            border: 1px dotted #ccc;
            border-radius: 5px;      
            pointer-events: none;
            height: 30px;
            opacity: 0.5; 
        }

        body {
            border-width: 10px;
            border-color: black;
            border-style: solid;
            min-width: calc(100vw - 20px);
            min-height: calc(100vh - 20px);
            margin:0;
        }
    </style>
</head>


<body style="background-color: aqua;">
    <div class="container" style="display: flex; flex-direction: row; width: 100%; background-color: beige;">
        <div class="column" id="column1">
            <h1 contenteditable>Backlog</h1>
            <div class="item" draggable contenteditable>Item 1</div>
            <div class="item" draggable contenteditable>Item 2</div>
            <div class="item" draggable contenteditable>Item 3</div>
            <div class="item" draggable contenteditable>Item 4</div>
        </div>
        
        <div class="column" id="column2">
            <h1 contenteditable>Backlog</h1>
            <div class="item" draggable contenteditable>Item 5</div>
            <div class="item" draggable contenteditable>Item 6</div>        
        </div>

        <div class="column" id="column3">
            <h1 contenteditable>Backlog</h1>
            <div class="item" draggable contenteditable>Item 7</div> 
        </div>

        <div class="column" id="column4">
            <h1 contenteditable>Backlog</h1>
            <div class="item" draggable contenteditable>Item 8</div> 
        </div>
    </div>
    
    <script>
        // Retrieve item positions from localStorage
        const itemPositions = JSON.parse(localStorage.getItem('itemPositions'));
        console.log(itemPositions);
        if (itemPositions) {
            Object.entries(itemPositions).forEach(([columnId, { items, heading }]) => {
                console.log(columnId, items, heading);

                const column = document.getElementById(columnId);
                if (column) {
                    // Remove existing items
                    column.innerHTML = '';
                    
                    // Insert heading
                    const h1 = document.createElement('h1');
                    h1.contentEditable = true;
                    h1.textContent = heading;
                    column.appendChild(h1);
                    
                    // Insert items in the specified order
                    items.forEach(itemId => {
                        const item = document.createElement('div');
                        item.classList.add('item');
                        item.draggable = true;
                        //item.contentEditable = true;
                        item.textContent = itemId;
                        item.addEventListener('dragstart', dragStart);
                        item.addEventListener('dragend', dragEnd);
                        column.appendChild(item);
                    });
                }
            });
        }

    
        const items = document.querySelectorAll('.item');
        const columns = document.querySelectorAll('.column');
        let draggedItem = null;
        
        // Add event listeners for drag and drop functionality
        items.forEach(item => {
            item.addEventListener('dragstart', dragStart);
            item.addEventListener('dragend', dragEnd);
        });
        
        columns.forEach(column => {
            column.addEventListener('dragover', dragOver);
            column.addEventListener('dragenter', dragEnter);
            column.addEventListener('dragleave', dragLeave);
            column.addEventListener('drop', drop);
            column.addEventListener('drop', saveItemPositions);
        });


        // Drag functions
        function dragStart() {
            draggedItem = this;
            setTimeout(() => {
                PLACEHOLDER.style.display = 'block';
                this.style.display = 'none';
            }, 0);
        }
        
        function dragEnd() {
            setTimeout(() => {
                PLACEHOLDER.style.display = 'none';
                draggedItem.style.display = 'block';
                draggedItem = null;
            }, 0);
        }


        const PLACEHOLDER = document.createElement('div');
        PLACEHOLDER.classList.add('placeholder');
        
        function dragOver(e) {
            e.preventDefault();

            const draggedBefore = getDragAfterElement(this, e.clientY);
            if (typeof(draggedBefore) == 'undefined' || draggedBefore  == null) {
                this.appendChild(PLACEHOLDER);
            } else {
                this.insertBefore(PLACEHOLDER, draggedBefore);
            }
        }
        
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.item:not(.dragging)')];
        
            return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        function dragEnter(e) {
            e.preventDefault();
        }
        
        function dragLeave() {
        }
        
        function drop(e) {
            const draggedBefore = getDragAfterElement(this, e.clientY);

            if (typeof(draggedBefore) == 'undefined' || draggedBefore  == null) {
                this.appendChild(draggedItem);
            } else {
                this.insertBefore(draggedItem, draggedBefore);
            }

            this.style.backgroundColor = '#f2f2f2';
        }

        // Function to save item positions and h1 headings to localStorage
        function saveItemPositions() {
            const itemPositions = {};
            columns.forEach(column => {
                const columnId = column.id;
                const items = column.querySelectorAll('.item');
                const itemIds = Array.from(items).map(item => item.textContent);
                const heading = column.querySelector('h1').textContent;
                itemPositions[columnId] = { items: itemIds, heading: heading };
            });
            localStorage.setItem('itemPositions', JSON.stringify(itemPositions));
        }

        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault();
                saveItemPositions();
                animateBorder();
            }
        });


        // Function to animate the border
        function animateBorder() {
            const body = document.querySelector('body');
            const borderSpeed = 0.3; // Change the border speed to 1 or 2 seconds
            body.style.transition = `border-color ${borderSpeed}s linear`; // Add transition property for border color change
            
            setTimeout(() => {
            body.style.borderColor = 'hsl(120, 100%, 50%)'; // Change border color to a different hue
            }, 0);

            setTimeout(() => {
            body.style.borderColor = 'hsl(120, 100%, 0%)'; // Change border color to another hue
            }, borderSpeed * 1500);            
        }

    </script>
</body>
</html>